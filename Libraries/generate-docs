#!/usr/bin/env bash
# generate-docs.sh

set -euo pipefail

# Get the script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LIBRARY_DIR="$SCRIPT_DIR/Libraries"

# Generate the symlink script
SYMLINK_SCRIPT=$(
	nix eval -f "$LIBRARY_DIR/doc-generator.nix" \
		--arg lib '(import <nixpkgs> {}).lib' \
		'generateSymlinks' \
		--raw
)

# Execute the generated script
bash -c "$SYMLINK_SCRIPT" -- "$LIBRARY_DIR" "$LIBRARY_DIR/Documentation"

# Generate index
INDEX_CONTENT=$(nix eval -f "$LIBRARY_DIR/doc-generator.nix" \
	--arg lib '(import <nixpkgs> {}).lib' \
	'createIndex' \
	--raw)

echo "$INDEX_CONTENT" >"$LIBRARY_DIR/Documentation/README.md"
echo "Index generated: $LIBRARY_DIR/Documentation/README.md"
