#!/bin/sh
# shellcheck enable=all

initialize_bin() {
	DOTS="${PWD:-"$(pwd -P)"}"
	export DOTS
	export DOTS_LIB="${DOTS}/Libraries"
	export DOTS_CFG="${DOTS}/Configuration"
	export DOTS_LIB_BASH="${DOTS_LIB}/bash"
	export DOTS_LIB_CMD="${DOTS_LIB}/cmd"
	export DOTS_LIB_NIX="${DOTS_LIB}/nix"
	export DOTS_LIB_NU="${DOTS_LIB}/nushell"
	export DOTS_LIB_PS="${DOTS_LIB}/powershell"
	export DOTS_LIB_PY="${DOTS_LIB}/python"
	export DOTS_LIB_RS="${DOTS_LIB}/rust"
	export DOTS_LIB_SH="${DOTS_LIB}/shellscript"
	export DOTS_LIB_XML="${DOTS_LIB}/xml"

	export BINIT_PATH="${DOTS_LIB_SH}/base/binit"
	export BINIT_ACTION="--run"

	if [ -f "${BINIT_PATH}" ]; then :; else
		printf "direnv: binit not found at %s\n" "${BINIT_PATH}" >&2
	fi

	if [ -x "${BINIT_PATH}" ]; then :; else
		chmod -c +x "${BINIT_PATH}"
	fi

	if . "${BINIT_PATH}"; then :; else
		printf "direnv: Failed to initialize bin at %s\n" "${BINIT_PATH}" >&2
	fi
}

initialize_flake() {
	command -v nix >/dev/null 2>&1 && use flake . --no-pure-eval
}

# . .dotsrc
initialize_bin
initialize_flake
